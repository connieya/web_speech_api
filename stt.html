<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Speech Detection</title>
    <link rel="stylesheet" href="css/stt.css" />
  </head>
  <body>
    <div class="words" contenteditable></div>

    <script>
      const words = document.querySelector(".words");
      window.SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;

      let recognition = new SpeechRecognition();
      recognition.interimResults = true;
      recognition.lang = "ko-KR";
      // recognition.continuous = true;
      // recognition.maxAlternatives = 5;
      console.log(recognition);

      let makeNewTextContent = function () {
        p = document.createElement("p");
        document.querySelector(".words").appendChild(p);
        console.log("p = ", p);
      };

      let p = null;

      recognition.start();
      console.log("start .....");
      recognition.onstart = function () {
        console.log("onstart ...");
        makeNewTextContent(); // 음성 인식 시작시마다 새로운 문단을 추가한다.
      };
      recognition.onend = function () {
        console.log("onend ... ");
        recognition.start();
      };

      recognition.onresult = function (e) {
        let texts = Array.from(e.results)
          .map((results) => results[0].transcript)
          .join("");

        console.log("texts = ", texts);
        // console.log("today = ", new Date());
        texts.replace(/느낌표|강조|뿅/gi, "❗️");

        p.textContent = texts;
        // console.log("p = ", p);
      };
    </script>
  </body>
</html>
